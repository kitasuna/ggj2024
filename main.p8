pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- comment
#include _game.lua
#include gram.lua
#include input.lua
#include baddies.lua
#include player.lua

_chars = {}
_dialog = {}
_test0 = {"웃","⧗"}
_test1 = {"⧗","ˇ"}
_test2 = {"웃","⧗","▤"}

STATE_EXPLORE = "explore"
STATE_SHOWTIME = "showtime"
_current_state = STATE_EXPLORE

_last_t = 0
function _init()
  printh("_init")
  _last_t = time()
  _chars = split("웃,♥,⧗,ˇ,▤,✽")
  -- _chars = shuffle(_chars)
  input:init(_chars)

  -- init grammar
  gs[1]:init(_chars)
  gs[1]:debug()
  -- Make some strings!
  for i=1,6 do 
    _dialog[i] = gs[1]:gen(3)
  end

  -- give baddies some dialog
  baddie_mngr:init()
  baddie_mngr:add(32, 32, false, _dialog[flr(rnd(#_dialog))+1])
  baddie_mngr:add(64, 64, true, _dialog[flr(rnd(#_dialog))+1])

  -- player
  player:init()
end

function _update60()
  local now = time()
  local dt = now - _last_t
  _last_t = now
  if _current_state == STATE_EXPLORE then
    _explore_update(dt)
  else 
    _showtime_update(dt)
  end
end

function _draw()
  if _current_state == STATE_EXPLORE then
    _explore_draw(dt)
  else 
    _showtime_draw(dt)
  end
end


__gfx__
00000000bb8888bbbb8888bbbb8888bbbb8888bb0000000000000000bbbebebbbbbbbbbb00000000000000000000000000000000000000000000000000000000
00000000b888888bb888888bb888888bb888888b0000000000000000bbeeeeebbbbebebe00000000000000000000000000000000000000000000000000000000
00700700888c9c9b888c9c9b888c9c9b888c9c9b0000000000000000bee8e8bbebeeeeeb00000000000000000000000000000000000000000000000000000000
00077000889999bb889999bb889999bb889999bb0000000000000000ebeeeebebee8e8bb00000000000000000000000000000000000000000000000000000000
00077000b666666bb666666bb666666bb666666b0000000000000000bb8888bbbbeeeebb00000000000000000000000000000000000000000000000000000000
00700700bb6666bbbb6666bbbb6666bbbb6666bb0000000000000000bbebbebbbb8888bb00000000000000000000000000000000000000000000000000000000
00000000bb6666bbbb6666bbbb6666bbbb6666bb0000000000000000bbebbebbbbebbebb00000000000000000000000000000000000000000000000000000000
00000000b6bbbb6bb6bbbb6bb6bbbb6bb6bbbb6b0000000000000000bbeebeebbbebbebb00000000000000000000000000000000000000000000000000000000
bbb77bbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb7887bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b788887b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
78888887000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77788777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb7887bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb7887bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb7777bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000
bbbbbb9999999bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000
bbbb9999999999bbb99bbbbbbbbbbbbbbbbbbbbbbbb99bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb999000000000000000000000000000000000000000000000000
bbb99999bbb99999b99bbbbbbbbbbbbbbbbbbbbbbbb99bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb999000000000000000000000000000000000000000000000000
bb9999bbbbbbb999999bbbbbbbbbbbbbbbbbbbbbbbb999bbb99bbbbbbbbbbbbbbbbbbbbbbbbb999b000000000000000000000000000000000000000000000000
bb999bbbbbbbbb9999bbbbbbbbbbbbbbbbbbbbbbbbb99999b99bbbbbbbbbbbbbbbbbbbbbbbbb999b000000000000000000000000000000000000000000000000
bb999bbbbbbbbbbb99bbbbbbbbbbbbbbbbbbbbb999999999bbbbbbbbbbbbbbbb99999bbbbbbb99bb000000000000000000000000000000000000000000000000
bbb999bbbbbbbbbb99bbbbbbbbbbbbbbbbbbbbb9999999bbbbbbb99bbbbbbbbb999999bbbbbb99bb000000000000000000000000000000000000000000000000
bbb9999bbbbbbbbb99bbbbbbbbbbbbbbbbbbbbbbbbbb99bbb99bb9999999999b99b999bbbbb999bb000000000000000000000000000000000000000000000000
bbbb999999bbbbbb999999bbbb999bbbbbbbbbbbbbbb99bbb99bb9999999999999bb99bbbbb99bbb000000000000000000000000000000000000000000000000
bbbbbb9999999bbb9999999bb999999b99bbbbbb99bb99bbb99bb99999999999999999bbbbb99bbb000000000000000000000000000000000000000000000000
bbbbbbbbb9999999b99b999bb999999999b999b999bb99bbb999b999b999bb99999999bbbb999bbb000000000000000000000000000000000000000000000000
bb999bbbbbb99999b99bb99b999bb999999999999bbb99bbb999b99bb999bb9999bbbb999b999bbb000000000000000000000000000000000000000000000000
bb9999bbbbbbbb99b99bb99b999b999b99999999bbb999bbbb99b99bb99bbb9999bb99999bbbbbbb000000000000000000000000000000000000000000000000
bbb999999bbb9999b99bb99bb999999bb9999999bbb999bbbb99b99bbbbbbb9999999999bb999bbb000000000000000000000000000000000000000000000000
bbbb999999999999b99bb99bbb9999bbb99b999bbbbbbbbbbb99bbbbbbbbbb99999999bbbb999bbb000000000000000000000000000000000000000000000000
__gff__
0000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
